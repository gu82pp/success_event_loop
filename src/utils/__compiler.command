#!/bin/bash

# --- –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø ---
# 1. –Ü–º'—è –≤–∏—Ö—ñ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª—É
OUTPUT_FILENAME="utils-bundle.js"

# üí° –î–û–î–ê–ù–ê –ó–ê–ß–ï–ö–ê - –ì–ê–†–ê–ù–¢–£–Ñ, –©–û –ó–ë–ï–†–ï–ñ–ï–ù–ù–Ø –ó–ê–í–ï–†–®–ï–ù–û
sleep 0.5

# 2. –®–ª—è—Ö, –¥–µ –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è —Å–∫—Ä–∏–ø—Ç (—Ç–æ–±—Ç–æ –ø–æ—Ç–æ—á–Ω–∞ –ø–∞–ø–∫–∞)
SCRIPT_DIR="$(dirname "$0")"

# –ü–µ—Ä–µ—Ö–æ–¥–∏–º–æ –≤ –ø–∞–ø–∫—É, –¥–µ –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è —Å–∫—Ä–∏–ø—Ç
cd "$SCRIPT_DIR"

# –û—á–∏—â—É—î–º–æ –≤–∏—Ö—ñ–¥–Ω–∏–π —Ñ–∞–π–ª, —è–∫—â–æ –≤—ñ–Ω —ñ—Å–Ω—É—î
> "$OUTPUT_FILENAME"

# --- –õ–û–ì–Ü–ö–ê –û–ë'–Ñ–î–ù–ê–ù–ù–Ø ---
echo "–ü–æ—á–∏–Ω–∞—î–º–æ –æ–±'—î–¥–Ω–∞–Ω–Ω—è JS-—Ñ–∞–π–ª—ñ–≤ —É ${OUTPUT_FILENAME}..."
echo "------------------------------------------------------"

# –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ 'find' –¥–ª—è –ø–æ—à—É–∫—É –≤—Å—ñ—Ö .js —Ñ–∞–π–ª—ñ–≤, –∫—Ä—ñ–º —Å–∞–º–æ–≥–æ bundle.js
# -type f: —Ç—ñ–ª—å–∫–∏ —Ñ–∞–π–ª–∏
# -name "*.js": —à—É–∫–∞—î–º–æ —Ñ–∞–π–ª–∏ –∑ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è–º .js
# -not -name "$OUTPUT_FILENAME": –≤–∏–∫–ª—é—á–∞—î–º–æ –≤–∏—Ö—ñ–¥–Ω–∏–π —Ñ–∞–π–ª –∑—ñ —Å–ø–∏—Å–∫—É
find . -maxdepth 1 -type f -name "*.js" -not -name "$OUTPUT_FILENAME" | sort | while read -r file; do
    
    # 1. –í–∏–≤–æ–¥–∏–º–æ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ —Ñ–∞–π–ª —É –∫–æ–Ω—Å–æ–ª—å
    echo ">> –î–æ–¥–∞—î–º–æ —Ñ–∞–π–ª: $file"
    
    # 2. –î–æ–¥–∞—î–º–æ –∫–æ–º–µ–Ω—Ç–∞—Ä —É bundle.js –¥–ª—è —Ä–æ–∑–¥—ñ–ª–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤
    echo "/* --- –ü–æ—á–∞—Ç–æ–∫ —Ñ–∞–π–ª—É: $file --- */" >> "$OUTPUT_FILENAME"
    
    # 3. –î–æ–¥–∞—î–º–æ –≤–º—ñ—Å—Ç —Ñ–∞–π–ª—É –¥–æ –∫—ñ–Ω—Ü—è bundle.js
    cat "$file" >> "$OUTPUT_FILENAME"
    
    # 4. –î–æ–¥–∞—î–º–æ –Ω–æ–≤–∏–π —Ä—è–¥–æ–∫ –¥–ª—è —á–∏—Å—Ç–æ—Ç–∏
    echo -e "\n" >> "$OUTPUT_FILENAME"
done

# --- –ó–ê–í–ï–†–®–ï–ù–ù–Ø ---
echo "------------------------------------------------------"
if [ -f "$OUTPUT_FILENAME" ]; then
    echo "‚úÖ –û–±'—î–¥–Ω–∞–Ω–Ω—è –∑–∞–≤–µ—Ä—à–µ–Ω–æ —É—Å–ø—ñ—à–Ω–æ!"
    echo "–°—Ç–≤–æ—Ä–µ–Ω–æ —Ñ–∞–π–ª: ${OUTPUT_FILENAME}, —Ä–æ–∑–º—ñ—Ä: $(du -sh "$OUTPUT_FILENAME" | awk '{print $1}')"
else
    echo "‚ùå –ü–æ–º–∏–ª–∫–∞: –ù–µ –≤–¥–∞–ª–æ—Å—è —Å—Ç–≤–æ—Ä–∏—Ç–∏ –≤–∏—Ö—ñ–¥–Ω–∏–π —Ñ–∞–π–ª."
fi

# –¶–µ –∑–∞–ø–æ–±—ñ–≥–∞—î –º–∏—Ç—Ç—î–≤–æ–º—É –∑–∞–∫—Ä–∏—Ç—Ç—é –≤—ñ–∫–Ω–∞ —Ç–µ—Ä–º—ñ–Ω–∞–ª—É –ø—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è
# echo "–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å Enter, —â–æ–± –∑–∞–∫—Ä–∏—Ç–∏ –≤—ñ–∫–Ω–æ..."
# read -r